<html>
    <p class="title" style="display:none;">另一个
    </p>
</html>
<html>
    <p class="article_id" style="display:none;">6911217131254185991</p>
</html>
<html>
    <p class="target" style="display:none;">前端|threejs</p>
</html>
<html>
    <p class="create_time" style="display:none;">1128841071708</p>
</html>
<html>
    <p class="update_time" style="display:none;">1609143155000</p>
</html>
<html>
    <p class="cover_image" style="display:none;">https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f4838afdfc1045bc88798ea761120e7f~tplv-k3u1fbpfcp-watermark.image</p>
</html>
<html>
    <p class="brief_content" style="display:none;">... 3D工程师在交给你一项3D工程的时候会有很多贴图，比如发光贴图，凹凸贴图、颜色贴图、环境贴图、等等...</p>
</html>

---\n# 主题列表：juejin, github, smartblue, cyanosis, channing-cyan, fancy, hydrogen, condensed-night-purple, greenwillow, v-green, vue-pro, healer-readable, mk-cute, jzman, geek-black, awesome-green\n# 贡献主题：https://github.com/xitu/juejin-markdown-themes\ntheme: sunhuapeng\nhighlight:\n---\n\n1、创建一个基础场景\n\t包含场景`scene`、透视相机`PerspectiveCamera`、控制器`OrbitControls`、点光源`PointLight`、半球光`HemisphereLight`、渲染器`WebGLRenderer`，以及今天的主角`FBXLoader` fbx加载器\n    \n场景背景颜色设置为`0xf65144`\n\n``` javascript\nscene = new THREE.Scene();\nscene.fog = new THREE.Fog(0x000000, 600, 3000); //雾化场景\nscene.background = new THREE.Color(0xf65144);\n```\n\n透视相机位置设置为正对x轴\n\n```javascript\ncamera = new THREE.PerspectiveCamera(\n  45,\n  window.innerWidth / window.innerHeight,\n  1,\n  10000\n);\ncamera.position.set(0, 0, 200); //设置相机位置\n```\n\n灯光采用半球光和点光源两种\n\n半球光用来渲染整个场景的颜色，点光源用来渲染模型高光\n\n``` javascript\n// 设置光照\n// 半球光\nconst hemisphereLight = new THREE.HemisphereLight(\n  0xffffff,\n  0x444444,\n  1\n);\n// hemisphereLight.position.set(0, 200, 0);\nscene.add(hemisphereLight);\n// 点光源\nlight = new THREE.PointLight(0xffff00, 2, 100);\nlight.position.set(0, 0, 0);\nscene.add(light);\n\n```\n...\n\n所有基础元素创建完成后，可以在页面看到这样的场景\n\n\u003cimg src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/df963a4eda744ae7b8cf04ee1dac9009~tplv-k3u1fbpfcp-watermark.image\" style=\"zoom:33%;\" /\u003e\n\n接下载要使用到fbxloader\n\n文件的引用\n```\n    \u003cscript src=\"../../../three.js-master\\examples\\js\\loaders\\FBXLoader.js\"\u003e\u003c/script\u003e\n```\n\n因为是在html内写的代码，所以路径为当前文件的相对路径，可以根据自己文件位置进行更改\n\n官网内有对于fbx加载器的使用，这里不赘述，主要讲一下材质和贴图\n\n![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c45f72ed4e0f4b5b8eb06b9748b7a7ad~tplv-k3u1fbpfcp-watermark.image)\n\n``` javascript\n// 模型地址\nconst url = \"../model/fbx/beats耳机/source/beats_highpoly.fbx\"\nconst loader = new THREE.FBXLoader()\nloader.load(\n  url,\n  function (loadedModel) {\n    console.log(loadedModel);\n    mesh = loadedModel.children[0].clone();\n    scene.add(mesh);\n  }\n);\n```\n\n在加载的过程中遇到一些小问题，fbx依赖的Inflate.min.js文件找不到\n\n需要在js中引入intflate.min.js\n\n```javascript\n      \u003cscript src=\"../../../three.js-master\\examples\\js\\loaders\\FBXLoader.js\"\u003e\u003c/script\u003e\n      \u003cscript src=\"../../../three.js-master\\examples\\js\\libs\\inflate.min.js\"\u003e\u003c/script\u003e\n```\n\n加载后可以看出来，没有对模型进行材质的修改和贴图，材质本身是黑色的\n\n![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b4ba70b5885a41d6ab1d27bd7f8e72d6~tplv-k3u1fbpfcp-watermark.image)\n\n在上面代码中，我们打印一下`loadedModel` 是一个组对象`group`，组对象没有材质，而且并不是咱们最终要加载的模型对象，可以看一下组对象的children中的结果，有一个mesh对象，这是咱们需要渲染的对象，打印一下可以看到material材质对象\n\n![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/df793546c41e44e6a8653fd944980b91~tplv-k3u1fbpfcp-watermark.image)\n\n模型本身的材质是一个[Phong网格材质](https://threejs.org/docs/index.html#api/zh/materials/MeshPhongMaterial)\n\n那么一会的贴图也会选择这样的材质\n\n首选如果要贴图肯定需要将贴图加载为纹理，这样就要用到 `TextureLoader`\n\n```javascript\nconst textureLoader = new THREE.TextureLoader();\nconst textureUrl = \"../model/fbx/beats耳机/textures/beats_red.png\"\nconst textureNormal = textureLoader.load(\n  textureUrl\n);\n```\n\n原本贴图样式\n\n![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dc0fe131a1b24078a654f7ebe90a7d63~tplv-k3u1fbpfcp-watermark.image)\n\n这张图，是3D工程师导出工程的时候通过某种手段生成的，感兴趣的童鞋可以跟身边的3D工程师了解\n\n至于每个贴图点，每个位置能够对应上模型，也是在3D工程生成时候计算好的，作为前端只是拿来用就可以\n\n接下来对模型进行材质的重新渲染\n\n```\nmesh = loadedModel.children[0].clone();\nmesh.material = new THREE.MeshPhongMaterial({\n  color: 0x00ffff,\n})\nconsole.log(mesh);\nscene.add(mesh);\n```\n\n先小试一下\n\n![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2aa16870544347949c5d224908513004~tplv-k3u1fbpfcp-watermark.image)\n\n通过已经被改变的颜色不难发现，可以对模型的材质进行修改\n\n接下来需要将我们加载好的纹理贴图和模型结合上，\n\n3D工程师在交给你一项3D工程的时候会有很多贴图，比如发光贴图，凹凸贴图、颜色贴图、环境贴图、等等...\n\n![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c973183b56c34751a723751cc5554437~tplv-k3u1fbpfcp-watermark.image)\n\n可以通过这里看出来之前默认为null的表示之前并未对它进行材质贴图，也可以通过官网上面的material查看这些贴图具体什么作用\n\n此次我们要对贴图进行重新渲染的是map 颜色贴图\n\n所以将map设置为之前定义的 `textureNormal` 即可\n\n``` javascript\n // 模型地址\nconst url = \"../model/fbx/beats耳机/source/beats_highpoly.fbx\";\nconst loader = new THREE.FBXLoader();\nloader.load(url, function (loadedModel) {\n  const textureLoader = new THREE.TextureLoader();\n  const textureUrl =  \"../model/fbx/beats耳机/textures/beats_red.png\"\n  const textureNormal = textureLoader.load(\n    textureUrl\n  );\n  mesh = loadedModel.children[0].clone();\n  mesh.material.map = textureNormal\n  console.log(loadedModel.children[0]);\n  scene.add(mesh)\n});\n```\n\n![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/78c6c1b019bf40049ed3931bd3390710~tplv-k3u1fbpfcp-watermark.image)\n\n接下来我们就可以通过一些微调改变一下模型材质的展示\n\nmesh.material中有一个属性`shininess` 控制高光显示程度，可以对它进行控制，修改高光具体显示程度\n\n首先要调整的是灯光，我们之前对灯光只是设置上了，并没有调整打光的位置\n\n```\n// 设置光照\n// 半球光\nconst hemisphereLight = new THREE.HemisphereLight(\n  0xffaea8, // 天空发出颜色\n  0x7f0900, // 地面发出颜色\n  1 // 光照强度\n);\nhemisphereLight.position.set(0, 50, 60);\nscene.add(hemisphereLight);\n\n// 聚光灯\nconst spotLight = new THREE.SpotLight(0xffffff);\nspotLight.position.set(100, 60, 100);\nscene.add(spotLight);\n\nconst spotLightHelper = new THREE.SpotLightHelper(spotLight);\nscene.add(spotLightHelper);\n```\n\n在渲染动画中，将点光源进行一个位置的转换，这样就可以调整出不同位置的高光\n\n```\nfunction animate() {\nrequestAnimationFrame(animate);\nconst time = Date.now() * 0.0005;\nif (light) {\n  light.position.x = Math.sin(time * 0.7) * 50;\n  // light.position.y = Math.cos(time * 0.3) * 50;\n  light.position.z = Math.sin(time * 0.5) * 50;\n}\nrenderer.render(scene, camera);\n}\n```\n\n![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8d4fa8d4a16e46a39500dd7a0fa49d69~tplv-k3u1fbpfcp-watermark.image)\n\n最终调整的效果如下：\n\n![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/12ab6b28f9f2457ebced483c0c0688a5~tplv-k3u1fbpfcp-watermark.image)\n\n\n代码地址\n\n[html](https://github.com/sunhuapeng/sunhuapeng_2.0/blob/master/public/html/%E4%B8%AD%E7%BA%A7%E6%A1%88%E4%BE%8Bhtml/loadTexture.html)\n\n[模型](https://github.com/sunhuapeng/sunhuapeng_2.0/blob/master/public/html/model/fbx/beats%E8%80%B3%E6%9C%BA/source/beats_highpoly.fbx)\n\n[贴图](https://github.com/sunhuapeng/sunhuapeng_2.0/blob/master/public/html/model/fbx/beats%E8%80%B3%E6%9C%BA/textures/beats_red.png)\n\n\n\n\n